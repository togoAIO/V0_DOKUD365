<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Settle transactions by using CustTrans::settleTransaction | WIKA Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Settle transactions by using CustTrans::settleTransaction | WIKA Documentation ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="settle-transactions-by-using-custtranssettletransaction">Settle transactions by using CustTrans::settleTransaction</h1>

[!include[banner](../includes/banner.md)][!include[banner](../includes/preview-banner.md)]<h2 id="custtranssettletransact-is-obsolete">CustTrans::settleTransact is obsolete</h2>
<p>The <strong>settleTransact</strong> method on the CustTrans table has been marked as obsolete.</p>
<pre><code class="lang-X++">public static boolean settleTransact(
CustTable _custTable,
    LedgerVoucher _ledgerVoucher = null,
    boolean _balancePostingProfile = true,
    SettleDatePrinc _saveDatePrinciple = SettleDatePrinc::DateOfPayment,
    TransDate _saveDate = dateNull()
    ,DimSettlementType_RU _dimSettlementType = DimSettlementType_RU::None
    ,CustTrans _parentCustTrans = null)
</code></pre>
<h3 id="what-does-obsolete-mean">What does obsolete mean?</h3>
<p>When a method is marked as obsolete, it means the code is no longer required and we plan to eventually remove it from the product. The obsolete method will often recommend an alternative method that can be used. The referencing code will continue to work as expected with the obsolete method. No immediate action is required. But, referencing code should be refactored to use the replacement method.</p>
<p>For more information about obsolete processes, see <a href="../migration-upgrade/deprecation-deletion-apis.md">Deprecation of methods and metadata elements</a>.</p>
<h3 id="why-is-it-marked-as-obsolete">Why is it marked as obsolete?</h3>
<p>When many settlements are done at the same time for the same customer, database blocking occurs. Database blocking affects performance.</p>
<h3 id="what-does-the-method-do">What does the method do?</h3>
<p>The <strong>settleTransact</strong> method settles a set of invoices and payments for a specific customer. Settlement identifies this set of invoices by using the <strong>SpecCompany</strong>, <strong>SpecTableId</strong>, and <strong>SpecRecId</strong> columns of the SpecTrans table. Together, the columns define a settlement context.</p>
<p>The <strong>_custTable</strong> parameter of the <strong>settleTransact</strong> method defines the settlement context as the CustTable <strong>DataAreaId</strong>, <strong>TableId</strong>, and <strong>RecId</strong> values. The following example shows two contexts.</p>
<table>
<thead>
<tr>
<th>SpecCompany</th>
<th>SpecTableId</th>
<th>SpecRecId</th>
<th>Transaction</th>
</tr>
</thead>
<tbody>
<tr>
<td>USMF</td>
<td>7589</td>
<td>22565451428</td>
<td>1</td>
</tr>
<tr>
<td>USMF</td>
<td>7589</td>
<td>22565451428</td>
<td>2</td>
</tr>
</tbody>
</table>
<h2 id="replacement-method">Replacement method</h2>
<p>The <strong>settleTransaction</strong> method on the CustTrans table is the replacement method.</p>
<pre><code class="lang-X++">public static boolean settleTransaction(
    SpecTransExecutionContext _specTransExecutionContext,
    CustTransSettleTransactionParameters _parameters)
</code></pre>
<h3 id="how-blocking-will-be-avoided">How blocking will be avoided</h3>
<p>Every customer settlement will get a unique settlement context. Because each settlement that is done will have a unique context, no transaction will cause blocking.  The following example shows two contexts. Each context has a unique <strong>SpecRecId</strong> value.</p>
<table>
<thead>
<tr>
<th>SpecCompany</th>
<th>SpecTableId</th>
<th>SpecRecId</th>
<th>Transaction</th>
</tr>
</thead>
<tbody>
<tr>
<td>USMF</td>
<td>7599</td>
<td>68719604825</td>
<td>1</td>
</tr>
<tr>
<td>USMF</td>
<td>7599</td>
<td>68719604826</td>
<td>2</td>
</tr>
</tbody>
</table>
<h3 id="replacement-method-parameters">Replacement method parameters</h3>
<p>The <strong>SpecTransExecutionContext</strong> class defines a unique settlement execution context. It has two parts. The first part defines the customer or vendor for the settlement. The second part defines the source for the settlement.</p>
<ul>
<li><p>The <strong>newFromSource</strong> method takes a customer or vendor and a source. The customer or vendor is always the customer, and the source is always the customer.</p>
<pre><code class="lang-X++">public static SpecTransExecutionContext newFromSource(
    CustVendTable _custVendTable, 
    Common _source = _custVendTable)
</code></pre>
</li>
<li><p>The <strong>parmSpecContext</strong> method exposes the settlement context that is generated.</p>
<pre><code class="lang-X++">public Common parmSpecContext()
</code></pre>
</li>
</ul>
<p><strong>CustTransSettleTransactionParamters</strong> contains the other method parameters. It has a constructor method that initializes the class with default values. An example is <strong>LedgerVoucher</strong>.</p>
<h3 id="how-to-use-the-settletransaction-method">How to use the settleTransaction method</h3>
<p>Settlement is done in two parts. First, you mark the invoices and payments for settlement. Then you do the settlement.</p>
<h4 id="obsolete-code-example">Obsolete code example</h4>
<pre><code class="lang-X++">//Mark for settlement
SpecTransManager specTransManager = SpecTransManager::construct(custTable);

specTransManager.insert(…) //Invoice(s)
specTransManager.insert(…) //Payment(s)

//Settle
CustTrans::settleTransact(recipientCustVendTable);
</code></pre>
<h4 id="new-code-example">New code example</h4>
<pre><code class="lang-X++">//Mark for settlement
SpecTransExecutionContext specTransExecutionContext = SpecTransExecutionContext::newFromSource(custTable);
specTransManager = SpecTransManager::construct(specTransExecutionContext.parmSpecContext());

specTransManager.insert(…) //Invoice(s)
specTransManager.insert(…) //Payment(s)

//Settle
CustTrans::settleTransaction(
    specTransExecutionContext,
    CustTransSettleTransactionParameters::construct());
</code></pre>
<h3 id="testing">Testing</h3>
<p>This functionality uses flights. To test it, you must turn on the flight in a non-production environment. For information about how to turn on a flight in a non-production environment, see <a href="../data-entities/data-entities-data-packages.md#features-flighted-in-data-management-and-enabling-flighted-features">Data management overview</a>.</p>
<p>The name of the flight is <strong>EnableCustTransSettleTransaction</strong>.</p>
[!include[footer-include](../../../includes/footer-banner.md)]</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/togoAIO/V0_DOKUD365/blob/master/ProcessDoku/02_SupportProcesses/02_01_Finance/financial/settletransact-obsolete.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Customized Footer</span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
